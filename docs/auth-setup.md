Below are the exact steps to add a new `auth` package to your Turborepo monorepo, using **Better Auth** with **Prisma** for database management and **Credentials** (email/password) for authentication, then wiring it up in your Next.js app. I'll assume you're using TypeScript, a standard Turborepo structure (`apps/web` for Next.js, `packages/` for shared packages, `pnpm` as the package manager), and the Next.js App Router. Adjust for yarn/npm or Pages Router if needed.

---

### Step 1: Set Up the `auth` Package with Better Auth and Prisma

1. **Navigate to Your Turborepo Root**:
   ```bash
   cd your-turborepo-root
   ```

2. **Create the `auth` Package**:
   ```bash
   mkdir -p packages/auth
   cd packages/auth
   ```

3. **Initialize the Package**:
   ```bash
   pnpm init
   ```
   - Edit `packages/auth/package.json`:
     ```json
     {
       "name": "@repo/auth",
       "version": "0.0.0",
       "type": "module",
       "main": "./dist/index.js",
       "types": "./dist/index.d.ts",
       "scripts": {
         "build": "tsc",
         "dev": "tsc --watch",
         "migrate": "prisma migrate dev",
         "generate": "prisma generate"
       },
       "dependencies": {
         "better-auth": "^0.5.0",
         "@prisma/client": "^5.0.0",
         "prisma": "^5.0.0"
       },
       "devDependencies": {
         "@types/node": "^20.0.0",
         "typescript": "^5.0.0"
       }
     }
     ```
   - Adjust the scope (`@repo`) to match your monorepo naming convention.

4. **Install Dependencies**:
   ```bash
   pnpm add better-auth @prisma/client prisma
   pnpm add -D @types/node typescript
   ```
   - `better-auth` includes the core library and credentials provider.
   - `@prisma/client` and `prisma` are for database access and schema management.

5. **Set Up Prisma in the `auth` Package**:
   - Initialize Prisma:
     ```bash
     npx prisma init
     ```
   - This creates `packages/auth/prisma/schema.prisma` and `.env` (move `.env` to root if shared).
   - Edit `packages/auth/prisma/schema.prisma` for SQLite (simplest for dev; adjust for PostgreSQL/MySQL in production):
     ```prisma
     generator client {
       provider = "prisma-client-js"
     }

     datasource db {
       provider = "sqlite"  // Change to "postgresql" or "mysql" for production
       url      = env("DATABASE_URL")
     }

     // Better Auth required models (auto-generated by migration, but define for clarity)
     model User {
       id        String   @id @default(cuid())
       email     String   @unique
       password  String?
       name      String?
       createdAt DateTime @default(now())
       updatedAt DateTime @updatedAt
       sessions  Session[]
       accounts  Account[]
     }

     model Session {
       id        String   @id
       userId    String
       expiresAt DateTime
       user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
     }

     model Account {
       id           String   @id
       userId       String
       provider     String
       providerId   String
       createdAt    DateTime @default(now())
       updatedAt    DateTime @updatedAt
       user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
       @@unique([provider, providerId])
     }
     ```
   - Update the root `.env` (or move to `apps/web/.env.local` for app-specific):
     ```env
     DATABASE_URL="file:./db.sqlite"  # For SQLite; use postgresql://... for PostgreSQL
     BETTER_AUTH_SECRET=your-strong-secret-here  # Generate: openssl rand -base64 32
     BETTER_AUTH_URL=http://localhost:3000
     ```
   - Run initial migration to create tables:
     ```bash
     cd packages/auth
     npx prisma migrate dev --name init
     ```
     - This generates the SQLite file (or DB tables) and `@prisma/client`.

6. **Create TypeScript Config**:
   - Create `packages/auth/tsconfig.json`:
     ```json
     {
       "extends": "../../tsconfig.json",  // Assuming root tsconfig exists
       "compilerOptions": {
         "outDir": "./dist",
         "rootDir": "./src",
         "declaration": true,
         "module": "ESNext",
         "target": "ESNext"
       },
       "include": ["src/**/*"],
       "exclude": ["node_modules", "dist"]
     }
     ```
   - Ensure root `tsconfig.json` includes paths for easy imports:
     ```json
     {
       "compilerOptions": {
         "baseUrl": ".",
         "paths": {
           "@repo/auth/*": ["packages/auth/src/*"]
         }
       }
     }
     ```

7. **Configure Better Auth with Prisma and Credentials**:
   - Create `packages/auth/src/auth.ts`:
     ```typescript
     import { betterAuth } from "better-auth";
     import { prismaAdapter } from "better-auth/adapters/prisma";
     import { PrismaClient } from "@prisma/client";

     const prisma = new PrismaClient();

     export const auth = betterAuth({
       database: prismaAdapter(prisma, {
         provider: "sqlite",  // Match your schema.prisma provider
       }),
       secret: process.env.BETTER_AUTH_SECRET!,  // Required
       baseURL: process.env.BETTER_AUTH_URL || "http://localhost:3000",
       emailAndPassword: {
         enabled: true,  // Enables credentials provider
         async credentialsSignIn({ email, password }) {
           // Optional: Add custom validation (e.g., password strength)
           return { email, password };
         },
       },
     });
     ```
   - Export in `packages/auth/src/index.ts`:
     ```typescript
     export { auth } from "./auth";
     ```

8. **Update `turbo.json`** (in root, if needed):
   ```json
   {
     "pipeline": {
       "build": {
         "dependsOn": ["^build"],
         "outputs": [".next/**", "dist/**"]
       },
       "dev": {
         "cache": false
       },
       "migrate": {
         "dependsOn": [],
         "outputs": []
       }
     }
   }
   ```

9. **Build the Auth Package**:
   ```bash
   pnpm turbo run build --filter=@repo/auth
   ```

---

### Step 2: Add `auth` Package to Your Next.js App

1. **Navigate to the Next.js App**:
   ```bash
   cd apps/web
   ```

2. **Add the `auth` Package as a Dependency**:
   ```bash
   pnpm add @repo/auth@workspace:*
   ```

3. **Install Next.js-Specific Better Auth Dependencies**:
   ```bash
   pnpm add better-auth/next-js better-auth/react better-auth/cookies
   ```
   - `better-auth/next-js`: For server actions and Next.js integration.
   - `better-auth/react`: For client-side hooks.
   - `better-auth/cookies`: For middleware/session handling.

---

### Step 3: Wire Up Better Auth in Your Next.js App

1. **Update `auth` Config for Next.js**:
   - Modify `packages/auth/src/auth.ts` to include the Next.js plugin:
     ```typescript
     import { betterAuth } from "better-auth";
     import { prismaAdapter } from "better-auth/adapters/prisma";
     import { nextCookies } from "better-auth/next-js";
     import { PrismaClient } from "@prisma/client";

     const prisma = new PrismaClient();

     export const auth = betterAuth({
       database: prismaAdapter(prisma, {
         provider: "sqlite",
       }),
       secret: process.env.BETTER_AUTH_SECRET!,
       baseURL: process.env.BETTER_AUTH_URL || "http://localhost:3000",
       emailAndPassword: {
         enabled: true,
         async credentialsSignIn({ email, password }) {
           return { email, password };
         },
       },
       plugins: [nextCookies()],  // Add for cookie handling in server actions
     });
     ```

2. **Create the API Route**:
   - Create `apps/web/app/api/auth/[...all]/route.ts`:
     ```typescript
     import { auth } from "@repo/auth";
     import { toNextJsHandler } from "better-auth/next-js";

     export const { GET, POST } = toNextJsHandler(auth.handler);
     ```
   - This handles all auth endpoints (e.g., `/api/auth/sign-in`, `/api/auth/sign-up`).

3. **Create an Auth Client for Client Components**:
   - Create `apps/web/lib/auth-client.ts`:
     ```typescript
     import { createAuthClient } from "better-auth/react";

     export const authClient = createAuthClient({
       baseURL: process.env.BETTER_AUTH_URL || "http://localhost:3000",
     });
     ```

4. **Set Up Sign-In Page (Client Component)**:
   - Create `apps/web/app/signin/page.tsx`:
     ```tsx
     "use client";
     import { authClient } from "@/lib/auth-client";
     import { useRouter } from "next/navigation";
     import { useState } from "react";

     export default function SignIn() {
       const [email, setEmail] = useState("");
       const [password, setPassword] = useState("");
       const [error, setError] = useState("");
       const router = useRouter();

       const handleSignIn = async () => {
         try {
           const result = await authClient.signIn.email({
             body: { email, password },
           });
           if (result.data) {
             router.push("/dashboard");  // Redirect on success
           } else {
             setError("Invalid credentials");
           }
         } catch (e) {
           setError("An error occurred");
         }
       };

       return (
         <div>
           <h1>Sign In</h1>
           <input
             type="email"
             value={email}
             onChange={(e) => setEmail(e.target.value)}
             placeholder="Email"
           />
           <input
             type="password"
             value={password}
             onChange={(e) => setPassword(e.target.value)}
             placeholder="Password"
           />
           <button onClick={handleSignIn}>Sign In</button>
           {error && <p>{error}</p>}
         </div>
       );
     }
     ```

5. **Set Up Sign-Up Page (Similar)**:
   - Create `apps/web/app/signup/page.tsx`:
     ```tsx
     "use client";
     import { authClient } from "@/lib/auth-client";
     import { useRouter } from "next/navigation";
     import { useState } from "react";

     export default function SignUp() {
       const [email, setEmail] = useState("");
       const [password, setPassword] = useState("");
       const [name, setName] = useState("");
       const [error, setError] = useState("");
       const router = useRouter();

       const handleSignUp = async () => {
         try {
           const result = await authClient.signUp.email({
             body: { email, password, name },
           });
           if (result.data) {
             router.push("/dashboard");
           } else {
             setError("Sign-up failed");
           }
         } catch (e) {
           setError("An error occurred");
         }
       };

       return (
         <div>
           <h1>Sign Up</h1>
           <input
             type="text"
             value={name}
             onChange={(e) => setName(e.target.value)}
             placeholder="Name"
           />
           <input
             type="email"
             value={email}
             onChange={(e) => setEmail(e.target.value)}
             placeholder="Email"
           />
           <input
             type="password"
             value={password}
             onChange={(e) => setPassword(e.target.value)}
             placeholder="Password"
           />
           <button onClick={handleSignUp}>Sign Up</button>
           {error && <p>{error}</p>}
         </div>
       );
     }
     ```

6. **Protect Routes with Middleware**:
   - Create `apps/web/middleware.ts`:
     ```typescript
     import { NextRequest, NextResponse } from "next/server";
     import { getSessionCookie } from "better-auth/cookies";

     export async function middleware(request: NextRequest) {
       const sessionCookie = getSessionCookie(request);
       if (!sessionCookie && request.nextUrl.pathname.startsWith("/dashboard")) {
         return NextResponse.redirect(new URL("/signin", request.url));
       }
       return NextResponse.next();
     }

     export const config = {
       matcher: ["/dashboard/:path*"],
     };
     ```

7. **Use Auth in Server Components**:
   - Example in `apps/web/app/dashboard/page.tsx`:
     ```tsx
     import { auth } from "@repo/auth";
     import { headers } from "next/headers";

     export default async function Dashboard() {
       const session = await auth.api.getSession({ headers: await headers() });

       if (!session) {
         return <div>Please sign in to view this page.</div>;
       }

       return <div>Welcome, {session.user.name || session.user.email}!</div>;
     }
     ```

8. **Optional: Server Action for Sign-In**:
   - Create `apps/web/app/actions.ts`:
     ```typescript
     "use server";
     import { auth } from "@repo/auth";
     import { redirect } from "next/navigation";

     export async function signInAction(formData: FormData) {
       const result = await auth.api.signInEmail({
         body: {
           email: formData.get("email") as string,
           password: formData.get("password") as string,
         },
       });
       if (result.data) {
         redirect("/dashboard");
       }
       return { error: "Invalid credentials" };
     }
     ```
   - Use in a form (e.g., in `signin/page.tsx`):
     ```tsx
     "use client";
     import { signInAction } from "@/app/actions";

     export default function SignIn() {
       return (
         <form action={signInAction}>
           <input type="email" name="email" placeholder="Email" required />
           <input type="password" name="password" placeholder="Password" required />
           <button type="submit">Sign In</button>
         </form>
       );
     }
     ```

---

### Step 4: Test and Deploy

1. **Run Migrations**:
   - From `packages/auth`:
     ```bash
     pnpm migrate
     ```
   - This applies the Prisma schema to create `User`, `Session`, and `Account` tables.

2. **Start Development Server**:
   - From root:
     ```bash
     pnpm turbo run dev --filter=web
     ```
   - Visit `http://localhost:3000/signin` and `http://localhost:3000/signup` to test.

3. **Test Auth Flow**:
   - Sign up with an email/password.
   - Sign in and verify redirection to `/dashboard`.
   - Check `/api/auth/csrf` for a CSRF token to confirm API setup.
   - Access `/dashboard` to ensure middleware redirects unauthenticated users.

4. **Production Notes**:
   - Use a production database (e.g., PostgreSQL). Update `schema.prisma` and `DATABASE_URL`.
   - Secure `BETTER_AUTH_SECRET` in a secrets manager.
   - Ensure `BETTER_AUTH_URL` uses HTTPS (e.g., `https://yourdomain.com`).
   - Run `npx prisma migrate deploy` in production.

---

### Additional Notes
- **Prisma in Monorepo**: The Prisma client is in `packages/auth`, but you can create a shared `packages/db` for the `PrismaClient` instance and import it into `auth` to avoid duplication if other packages need DB access.
- **TypeScript Paths**: Ensure imports like `import { auth } from "@repo/auth"` work via `tsconfig.json` paths.
- **Error Handling**: Add proper error messages and validation in UI (e.g., password strength, email format).
- **Customizing Credentials**: Extend `credentialsSignIn` in `auth.ts` for custom logic (e.g., bcrypt for passwords, though Better Auth handles hashing by default).
- **Pages Router**: If using Pages Router, create API routes in `pages/api/auth/[...all].ts` with `toNodeHandler(auth.handler)` instead of `toNextJsHandler`.
- **Troubleshooting**:
   - Ensure `pnpm install` runs in root to link workspaces.
   - Check Prisma migrations (`npx prisma db push` for quick sync).
   - Verify env variables are loaded (`console.log(process.env.BETTER_AUTH_SECRET)`).

This setup provides a modular `auth` package with Prisma and credentials-based authentication, fully integrated with your Next.js app. Let me know if you need help with specific customizations or other providers!